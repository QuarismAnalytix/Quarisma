================================================================================
QUARISMA PROFILER ARCHITECTURE - CURRENT vs. DESIRED
================================================================================

CURRENT STATE (Incomplete)
================================================================================

┌─────────────────────────────────────────────────────────────────────────┐
│                          USER CODE                                      │
│  QUARISMA_PROFILE_SCOPE("op")  |  RecordFunction(scope)                  │
└──────────────────┬──────────────────────────────────────────────────────┘
                   │
        ┌──────────┴──────────┐
        │                     │
        ▼                     ▼
┌──────────────────┐  ┌──────────────────────────┐
│ profiler_scope   │  │ RecordFunction           │
│ (RAII)           │  │ (Callback System)        │
│                  │  │                          │
│ ✅ Timing        │  │ ✅ Callbacks registered  │
│ ✅ Memory track  │  │ ✅ Events triggered      │
│ ✅ Hierarchical  │  │ ✅ Observers notified    │
│ ❌ No callbacks  │  │ ❌ Events LOST           │
└────────┬─────────┘  └──────────────────────────┘
         │
         ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                      profiler_session                                    │
│                                                                          │
│ ✅ Session lifecycle (start/stop)                                       │
│ ✅ Hierarchical scope tracking                                          │
│ ✅ Memory tracking integration                                          │
│ ✅ Statistical analysis                                                 │
│ ✅ Report generation                                                    │
│ ❌ No RecordFunction integration                                        │
│ ❌ No event capture from callbacks                                      │
└──────────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                    Backend Profilers                                     │
│                                                                          │
│ ✅ Kineto Integration                                                   │
│ ✅ ITT Integration                                                      │
│ ✅ NVTX Support                                                         │
│ ✅ Native Profiler                                                      │
└──────────────────────────────────────────────────────────────────────────┘

PROBLEM: RecordFunction and profiler_session are DISCONNECTED
         Events from callbacks are LOST
         No high-level API for users


DESIRED STATE (After Implementation)
================================================================================

┌─────────────────────────────────────────────────────────────────────────┐
│                          USER CODE                                      │
│  QUARISMA_RECORD_FUNCTION("op")  |  record_function("op")                │
└──────────────────┬──────────────────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────────────────┐
│              record_function_api [NEW]                                   │
│                                                                          │
│ ✅ record_function() function                                           │
│ ✅ record_function_scope RAII class                                     │
│ ✅ QUARISMA_RECORD_FUNCTION macro                                         │
└──────────────────┬──────────────────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────────────────┐
│              RecordFunction                                              │
│              (Callback System)                                           │
│                                                                          │
│ ✅ Callbacks registered                                                 │
│ ✅ Events triggered                                                     │
│ ✅ Observers notified                                                   │
└──────────────────┬──────────────────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────────────────┐
│          callback_helpers [NEW]                                          │
│                                                                          │
│ ✅ register_profiler_callbacks()                                        │
│ ✅ unregister_profiler_callbacks()                                      │
│ ✅ create_event_recording_callback()                                    │
└──────────────────┬──────────────────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────────────────┐
│          event_recorder [NEW]                                            │
│                                                                          │
│ ✅ on_function_enter()                                                  │
│ ✅ on_function_exit()                                                   │
│ ✅ get_events()                                                         │
│ ✅ Thread-safe event storage                                            │
└──────────────────┬──────────────────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                      profiler_session [MODIFIED]                         │
│                                                                          │
│ ✅ Session lifecycle (start/stop)                                       │
│ ✅ Hierarchical scope tracking                                          │
│ ✅ Memory tracking integration                                          │
│ ✅ Statistical analysis                                                 │
│ ✅ Report generation                                                    │
│ ✅ RecordFunction integration [NEW]                                     │
│ ✅ Event capture from callbacks [NEW]                                   │
│ ✅ Event storage and retrieval [NEW]                                    │
└──────────────────┬──────────────────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                    Backend Profilers                                     │
│                                                                          │
│ ✅ Kineto Integration                                                   │
│ ✅ ITT Integration                                                      │
│ ✅ NVTX Support                                                         │
│ ✅ Native Profiler                                                      │
└──────────────────────────────────────────────────────────────────────────┘

SOLUTION: RecordFunction and profiler_session are CONNECTED
          Events from callbacks are CAPTURED
          High-level API for users


DATA FLOW DIAGRAM
================================================================================

CURRENT (Events Lost):
┌──────────────┐
│ User Code    │
└──────┬───────┘
       │
       ▼
┌──────────────────────────────────────────────────────────────────┐
│ RecordFunction::before()                                         │
│ - Calls start callbacks                                          │
│ - Observers notified                                             │
│ - Events LOST (no storage)                                       │
└──────────────────────────────────────────────────────────────────┘
       │
       ▼
┌──────────────────────────────────────────────────────────────────┐
│ RecordFunction::end()                                            │
│ - Calls end callbacks                                            │
│ - Observers notified                                             │
│ - Events LOST (no storage)                                       │
└──────────────────────────────────────────────────────────────────┘


DESIRED (Events Captured):
┌──────────────┐
│ User Code    │
└──────┬───────┘
       │
       ▼
┌──────────────────────────────────────────────────────────────────┐
│ RecordFunction::before()                                         │
│ - Calls start callbacks                                          │
│ - event_recorder::on_function_enter() [NEW]                      │
│ - profiler_event created and stored [NEW]                        │
└──────────────────────────────────────────────────────────────────┘
       │
       ▼
┌──────────────────────────────────────────────────────────────────┐
│ RecordFunction::end()                                            │
│ - Calls end callbacks                                            │
│ - event_recorder::on_function_exit() [NEW]                       │
│ - profiler_event updated with end time [NEW]                     │
└──────────────────────────────────────────────────────────────────┘
       │
       ▼
┌──────────────────────────────────────────────────────────────────┐
│ profiler_session::generate_report()                              │
│ - Retrieves events from event_recorder [NEW]                     │
│ - Merges with profiler_scope events                              │
│ - Includes in final report [NEW]                                 │
└──────────────────────────────────────────────────────────────────┘


COMPONENT DEPENDENCY GRAPH
================================================================================

record_function_api [NEW]
    ↓
RecordFunction (existing)
    ↓
callback_helpers [NEW]
    ↓
event_recorder [NEW]
    ↓
profiler_event [NEW]
    ↓
profiler_session [MODIFIED]
    ↓
Backend Profilers (existing)


INTEGRATION POINTS
================================================================================

1. profiler_session::start()
   - Calls register_profiler_callbacks()
   - Creates event_recorder
   - Stores callback handle

2. profiler_session::stop()
   - Calls unregister_profiler_callbacks()
   - Retrieves events from event_recorder
   - Merges with profiler_scope events

3. record_function()
   - Creates RecordFunction with USER_SCOPE
   - Callbacks automatically registered
   - Events captured by event_recorder

4. profiler_session::generate_report()
   - Includes RecordFunction events
   - Merges with profiler_scope events
   - Generates unified report

================================================================================

